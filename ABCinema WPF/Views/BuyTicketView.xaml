<Page x:Class="ABCinema_WPF.Views.BuyTicketView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
      xmlns:utils="clr-namespace:ABCinema_WPF.Utils"
      mah:DialogParticipation.Register="{Binding}"
      mc:Ignorable="d"
      Title="Купить билет" Background="#2E2E2E">
    
    <Page.Resources>
        <utils:PlusOneConverter x:Key="PlusOneConverter"/>
        <utils:InverseBoolConverter x:Key="BoolConverter"/>
    </Page.Resources>
    
    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Экран -->
            <RowDefinition Height="Auto"/> <!-- Сетка мест -->
            <RowDefinition Height="Auto"/> <!-- Инфо о фильме -->
        </Grid.RowDefinitions>

        <!-- Экран -->
        <TextBlock Grid.Row="0"
                   Text="          Экран          "
                   FontSize="32"
                   FontWeight="Bold"
                   Foreground="White"
                   HorizontalAlignment="Center"
                   Background="#3e3e3e"
                   Margin="0,0,0,30" />

        <!-- Сетка мест -->
        <ItemsControl Grid.Row="1"
                      ItemsSource="{Binding Seats}"
                      Background="#2E2E2E"
                      HorizontalAlignment="Center">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Rows="{Binding Hall.Rows}" Columns="{Binding Hall.SeatsPerRow}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Button Content="{Binding SeatNumber, Converter={StaticResource PlusOneConverter}}"
                            Command="{Binding DataContext.ShowDialogCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                            CommandParameter="{Binding}"
                            Margin="2"
                            Background="LimeGreen"
                            BorderBrush="Green"
                            mah:ControlsHelper.FocusBorderBrush ="DarkGreen"
                            IsEnabled="{Binding IsReserved, Converter={StaticResource BoolConverter}}"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Инфо о фильме -->
        <StackPanel Grid.Row="2"
                    Orientation="Vertical"
                    HorizontalAlignment="Center"
                    Margin="0,10,0,0">
            <TextBlock Text="{Binding Session.MovieTitle}" FontSize="20" Foreground="White" TextAlignment="Center" />
            <TextBlock Text="{Binding Session.StartTime, StringFormat='Начало: {0:dd.MM HH:mm}'}" FontSize="18" Foreground="LightGray" TextAlignment="Center" />
            <TextBlock Text="{Binding Session.BasePrice, StringFormat='Цена: {0}₽'}" FontSize="18" Foreground="LightGray" TextAlignment="Center" />
        </StackPanel>
    </Grid>
    
</Page>
