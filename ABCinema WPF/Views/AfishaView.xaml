<Page x:Class="ABCinema_WPF.Views.AfishaView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
      xmlns:dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
      xmlns:utils="clr-namespace:ABCinema_WPF.Utils"
      mc:Ignorable="d"
      mah:DialogParticipation.Register="{Binding}"
      Title="Афиша" Background="#2E2E2E">
    
    <Page.Resources>
        <utils:PriceConverter x:Key="Converter"/>
        <utils:InverseBoolConverter x:Key="BoolConverter"/>
        <Style TargetType="TextBlock" BasedOn="{StaticResource TextBlockStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsExpired}" Value="True">
                    <Setter Property="Foreground" Value="Black" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>
    <Grid>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- для шапки -->
            <RowDefinition Height="*"/>    <!-- для контента -->
        </Grid.RowDefinitions>
        
        <StackPanel Orientation="Horizontal" Grid.Row="0" Background="#3E3E3E">
            <TextBlock Text="Выберите дату:" TextAlignment="Right" Foreground="White" VerticalAlignment="Center" Margin="20, 10,0,10" FontSize="18"/>
            <Button x:Name="TodayButton" Command="{Binding TodayButtonClick}" CommandParameter="{Binding}" Margin="20, 10,0,10">
                <TextBlock Text="Сегодня" FontSize="18" > </TextBlock>
            </Button>
            <Button x:Name="TomorrowButton" Command="{Binding TomorrowButtonClick}" CommandParameter="{Binding}" Margin="20, 10,0,10">
                <TextBlock Text="Завтра" FontSize="18"> </TextBlock>
            </Button>
            <Button x:Name="DayAfterTomorrowButton" Command="{Binding DayAfterTomorrowButtonClick}" CommandParameter="{Binding}" Margin="20, 10,0,10">
                <TextBlock Text="Послезавтра" FontSize="18"> </TextBlock>
            </Button>
            <DatePicker x:Name="DatePicker" SelectedDate="{Binding SelectedDate, UpdateSourceTrigger=PropertyChanged}" Margin="20, 10,0,10"/>
            <Button x:Name="AddSessionButton" Command="{Binding ShowSessionDialogCommand}" CommandParameter="{Binding}" Margin="20, 10,0,10">
                <TextBlock Text="Добавить сеанс" FontSize="18"> </TextBlock>
            </Button>
            <Button x:Name="EditSessionButton"
                    Command="{Binding ShowUpdateSessionDialogCommand}"
                    CommandParameter="{Binding}"
                    Margin="20, 10,0,10">
                <TextBlock Text="Редактировать сеанс" FontSize="18" />
            </Button>

        </StackPanel>

        <ListView Grid.Row="1" ItemsSource="{Binding AfishaItems}">
            
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
                
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Background="#2E2E2E" CornerRadius="8" Padding="10" Margin="5">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
            
                                <!-- Постер -->
                                <Image Source="{Binding Poster}" Width="300" Height="600" Margin="0,0,20,0"/>
            
                                <!-- Инфо + кнопки -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding MovieTitle}" TextAlignment="Center" FontSize="24" Foreground="White" Margin="0,0,0,10"/>
            
                                    <!-- Горизонтальный список кнопок -->
                                    <ItemsControl ItemsSource="{Binding Sessions}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Vertical"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Vertical">
                                                    <Button Command="{Binding DataContext.SelectSessionCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                            CommandParameter="{Binding}"
                                                            Margin="5"
                                                            Padding="10,5"
                                                            IsEnabled="{Binding IsExpired, Converter={StaticResource BoolConverter}}">
                                                        <TextBlock Text="{Binding StartTime, StringFormat='{}{0:HH\\:mm}'}" />
                                                    </Button>
                                                    <TextBlock Text="{Binding BasePrice, Converter={StaticResource Converter}}" Background="#3E3E3E" TextAlignment="Center"/>
                                                    <!-- <TextBlock Text="{Binding BasePrice}" Background="#3E3E3E"/> -->
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                    
                </ListView.ItemTemplate>
        </ListView>

    </Grid>
</Page>
